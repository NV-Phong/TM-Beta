CREATE DATABASE TaskManager
GO

USE TaskManager
GO

CREATE TABLE [USER]
(
   [IDUser]   INTEGER IDENTITY NOT NULL,
   [UserName] NVARCHAR(50) NULL,
   [Email]    VARCHAR(50) NULL,
   [Password] VARCHAR(MAX) NULL,
   [Avatar]   VARCHAR(MAX) NULL,
   [Hide]     INTEGER NULL,

   PRIMARY KEY ([IDUser])
)
GO

CREATE TABLE [PROJECT]
(
   [IDProject]   INTEGER IDENTITY NOT NULL,
   [ProjectName] NVARCHAR(50) NULL,
   [IDLeader]    INTEGER NULL,
   [DayCreate]   DATETIME NULL,
   [Image]       NVARCHAR(MAX) NULL,
   [Hide]        INTEGER NULL,

   PRIMARY KEY ([IDProject])
)
GO

CREATE TABLE [STATUS]
(
   [IDStatus]   INTEGER IDENTITY NOT NULL,
   [IDProject]  INTEGER NOT NULL,
   [StatusName] NVARCHAR(50) NULL,

   PRIMARY KEY ([IDStatus])
)
GO

CREATE TABLE [TASK]
(
   [IDTask]    INTEGER IDENTITY NOT NULL,
   [IDProject] INTEGER NOT NULL,
   [IDStatus]  INTEGER NOT NULL,
   [TaskName]  NVARCHAR(50) NULL,
   [DayCreate] DATETIME NULL,
   [DayStart]  DATETIME NULL,
   [Deadline]  DATETIME NULL,
   [Hide]      INTEGER NULL,

   PRIMARY KEY ([IDTask])
)
GO

CREATE TABLE [TASKDETAILS]
(
   [IDTask]         INTEGER IDENTITY NOT NULL,
   [Description]    NVARCHAR(MAX) NULL,
   [Attachments]    NVARCHAR(MAX) NULL,

   PRIMARY KEY ([IDTask])
)
GO

CREATE TABLE [MEMBER]
(
   [IDMember]  INTEGER IDENTITY NOT NULL, 
   [IDUser]    INTEGER NOT NULL,
   [IDProject] INTEGER NOT NULL,

   PRIMARY KEY ([IDMember])
)
GO

CREATE TABLE [TEMPLATE]
(
   [IDTemplate] INTEGER IDENTITY NOT NULL,
   [TemplateName] NVARCHAR(50) UNIQUE NULL,

   PRIMARY KEY ([IDTemplate])
)
GO

CREATE TABLE [LISTTEMPLATE]
(
   [IDListTemplate] INTEGER IDENTITY NOT NULL,
   [IDTemplate] INTEGER NOT NULL,
   [StatusName] NVARCHAR(50) NULL,

   PRIMARY KEY ([IDListTemplate]) 
)
GO

CREATE TABLE [ASSIGNMENT]
(
   [IDAssignment] INTEGER IDENTITY NOT NULL,
   [IDUser]       INTEGER NOT NULL,
   [IDTask]       INTEGER NOT NULL,

   PRIMARY KEY ([IDUser],[IDTask])
)
GO

CREATE TABLE [PERMISSSION]
(
   [IDPermission] INTEGER IDENTITY NOT NULL,
   [IDUser]       INTEGER NOT NULL,
   [IDProject]    INTEGER NOT NULL,
   [Role]         NVARCHAR(MAX) NULL,
   [Object]       NVARCHAR(MAX) NULL,
   [Privilege]    NVARCHAR(MAX) NULL,

   PRIMARY KEY ([IDPermission])
)
GO

CREATE TABLE [WORKFLOW]
(
   [IDWorkflow] INTEGER IDENTITY NOT NULL,
   [IDStatus]   INTEGER NOT NULL,
   [Transition] NVARCHAR(MAX) NULL,

   PRIMARY KEY ([IDWorkflow])
)
GO

CREATE TABLE [CONDITION]
(
   [IDCondition]  INTEGER IDENTITY NOT NULL,
   [IDPermission] INTEGER NOT NULL,
   [IDWorkflow]   INTEGER NOT NULL,

   PRIMARY KEY ([IDCondition])
)
GO


ALTER TABLE [TASK] ADD FOREIGN KEY ([IDProject])
REFERENCES [PROJECT] ([IDProject])
ON UPDATE NO ACTION ON DELETE NO ACTION
GO

ALTER TABLE [TASK] ADD FOREIGN KEY ([IDStatus])
REFERENCES [STATUS] ([IDStatus])
ON UPDATE NO ACTION ON DELETE NO ACTION
GO

ALTER TABLE [TASKDETAILS] ADD FOREIGN KEY ([IDTask])
REFERENCES [TASK] ([IDTask])
ON UPDATE NO ACTION ON DELETE NO ACTION
GO

ALTER TABLE [MEMBER] ADD FOREIGN KEY ([IDUser])
REFERENCES [USER] ([IDUser])
ON UPDATE NO ACTION ON DELETE NO ACTION
GO

ALTER TABLE [MEMBER] ADD FOREIGN KEY ([IDProject])
REFERENCES [PROJECT] ([IDProject])
ON UPDATE NO ACTION ON DELETE NO ACTION
GO

ALTER TABLE [ASSIGNMENT] ADD FOREIGN KEY ([IDUser])
REFERENCES [USER] ([IDUser])
ON UPDATE NO ACTION ON DELETE NO ACTION
GO

ALTER TABLE [ASSIGNMENT] ADD FOREIGN KEY ([IDTask])
REFERENCES [TASK] ([IDTask])
ON UPDATE NO ACTION ON DELETE NO ACTION
GO

ALTER TABLE [PERMISSSION] ADD FOREIGN KEY ([IDUser])
REFERENCES [USER] ([IDUser])
ON UPDATE NO ACTION ON DELETE NO ACTION
GO

ALTER TABLE [PERMISSSION] ADD FOREIGN KEY ([IDProject])
REFERENCES [PROJECT] ([IDProject])
ON UPDATE NO ACTION ON DELETE NO ACTION
GO

ALTER TABLE [WORKFLOW] ADD FOREIGN KEY ([IDStatus])
REFERENCES [STATUS] ([IDStatus])
ON UPDATE NO ACTION ON DELETE NO ACTION
GO

ALTER TABLE [CONDITION] ADD FOREIGN KEY ([IDPermission])
REFERENCES [PERMISSSION] ([IDPermission])
ON UPDATE NO ACTION ON DELETE NO ACTION
GO

ALTER TABLE [CONDITION] ADD FOREIGN KEY ([IDWorkflow])
REFERENCES [WORKFLOW] ([IDWorkflow])
ON UPDATE NO ACTION ON DELETE NO ACTION
GO

ALTER TABLE [LISTTEMPLATE] ADD FOREIGN KEY ([IDTemplate])
REFERENCES [TEMPLATE] ([IDTemplate])
ON UPDATE NO ACTION ON DELETE NO ACTION
GO

ALTER TABLE [STATUS] ADD FOREIGN KEY ([IDProject])
REFERENCES [PROJECT] ([IDProject])
ON UPDATE NO ACTION ON DELETE NO ACTION
GO


SET QUOTED_IDENTIFIER ON
GO

SET QUOTED_IDENTIFIER OFF
GO





